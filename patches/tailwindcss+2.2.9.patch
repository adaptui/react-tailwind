diff --git a/node_modules/tailwindcss/lib/jit/lib/generateRules.js b/node_modules/tailwindcss/lib/jit/lib/generateRules.js
index f27f362..8738458 100644
--- a/node_modules/tailwindcss/lib/jit/lib/generateRules.js
+++ b/node_modules/tailwindcss/lib/jit/lib/generateRules.js
@@ -120,12 +120,15 @@ function applyImportant(matches) {
 // worth the complexity for that case.
 
 
-function applyVariant(variant, matches, context) {
+function applyVariant(variant, matches, hasLibVariant, context) {
   if (matches.length === 0) {
     return matches;
   }
 
   if (context.variantMap.has(variant)) {
+    let updateSort =
+      hasLibVariant &&
+      !['sm', 'md', 'lg', 'xl', '2xl', 'motion-safe', 'dark', 'motion-reduce'].includes(variant);
     let variantFunctionTuples = context.variantMap.get(variant);
     let result = [];
 
@@ -172,7 +175,7 @@ function applyVariant(variant, matches, context) {
         }
 
         let withOffset = [{ ...meta,
-          sort: variantSort | meta.sort
+          sort: updateSort ? 0n : variantSort | meta.sort,
         }, clone.nodes[0]];
         result.push(withOffset);
       }
@@ -233,6 +236,7 @@ function splitWithSeparator(input, separator) {
 function* resolveMatches(candidate, context) {
   let separator = context.tailwindConfig.separator;
   let [classCandidate, ...variants] = splitWithSeparator(candidate, separator).reverse();
+  let hasLibVariant = variants.includes('lib');
   let important = false;
 
   if (classCandidate.startsWith('!')) {
@@ -264,7 +268,8 @@ function* resolveMatches(candidate, context) {
             matches.push([{ ...sort,
               options: { ...sort.options,
                 ...options
-              }
+              },
+              sort: hasLibVariant ? 0n : sort.sort,
             }, rule]);
           }
         }
@@ -277,7 +282,8 @@ function* resolveMatches(candidate, context) {
           matches.push([{ ...sort,
             options: { ...sort.options,
               ...options
-            }
+            },
+              sort: hasLibVariant ? 0n : sort.sort,
           }, rule]);
         }
       }
@@ -290,7 +296,7 @@ function* resolveMatches(candidate, context) {
     }
 
     for (let variant of variants) {
-      matches = applyVariant(variant, matches, context);
+      matches = applyVariant(variant, matches, hasLibVariant, context);
     }
 
     for (let match of matches) {
diff --git a/node_modules/tailwindcss/lib/jit/lib/setupContextUtils.js b/node_modules/tailwindcss/lib/jit/lib/setupContextUtils.js
index dca42e0..0872ccb 100644
--- a/node_modules/tailwindcss/lib/jit/lib/setupContextUtils.js
+++ b/node_modules/tailwindcss/lib/jit/lib/setupContextUtils.js
@@ -520,11 +520,13 @@ function resolvePlugins(context, tailwindDirectives, root) {
 function registerPlugins(plugins, context) {
   let variantList = [];
   let variantMap = new Map();
+  let reservedBits = 20n;
   let offsets = {
-    base: 0n,
-    components: 0n,
-    utilities: 0n
+    base: (1n << reservedBits) << 0n,
+    components: (1n << reservedBits) << 1n,
+    utilities: (1n << reservedBits) << 2n
   };
+
   let pluginApi = buildPluginApi(context.tailwindConfig, context, {
     variantList,
     variantMap,
@@ -543,7 +545,7 @@ function registerPlugins(plugins, context) {
 
   let highestOffset = (args => args.reduce((m, e) => e > m ? e : m))([offsets.base, offsets.components, offsets.utilities]);
 
-  let reservedBits = BigInt(highestOffset.toString(2).length);
+  reservedBits = BigInt(highestOffset.toString(2).length);
   context.layerOrder = {
     base: 1n << reservedBits << 0n,
     components: 1n << reservedBits << 1n,
@@ -552,6 +554,7 @@ function registerPlugins(plugins, context) {
   reservedBits += 3n;
   let offset = 0;
   context.variantOrder = new Map(variantList.map((variant, i) => {
+    if (variant.includes('lib')) return [variant, 1n];
     let variantFunctions = variantMap.get(variant).length;
     let bits = 1n << BigInt(i + offset) << reservedBits;
     offset += variantFunctions - 1;
